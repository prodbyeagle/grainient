<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gradient with Grain Effect</title>
    <style>
      /* Reset some default styles */
      body,
      h1,
      p {
        margin: 0;
        padding: 0;
      }

      /* Dark mode and modern UI */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #121212;
        color: #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        padding: 1rem;
        box-sizing: border-box;
      }

      .container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        max-width: 1200px;
        width: 100%;
        padding: 1.5rem;
        background: #1e1e1e;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
        position: relative;
      }

      .canvas-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        max-height: 600px; /* Max height for canvas */
        overflow: hidden;
        background-color: #333;
        border: 2px solid #444;
        border-radius: 8px;
      }

      canvas {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensure the canvas scales properly */
        background-color: #333;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      }

      .controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        background-color: #2a2a2a;
        padding: 1.5rem;
        border-radius: 12px;
        border: 2px solid #555;
      }

      .control {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      label {
        font-size: 1.1rem;
        font-weight: 600;
      }

      input[type="color"],
      input[type="range"] {
        width: 100%;
      }

      input[type="color"] {
        height: 3rem;
        border: none;
        border-radius: 6px;
        background-color: #444;
        cursor: pointer;
      }

      input[type="range"] {
        height: 2rem;
      }

      span {
        display: block;
        font-size: 1rem;
        color: #ddd;
        text-align: center;
      }

      button {
        background-color: #007bff;
        color: #fff;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s, transform 0.2s;
      }

      button:hover {
        background-color: #0056b3;
      }

      button:active {
        transform: scale(0.98);
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
          align-items: center;
          padding: 1rem;
        }
      }

      /* Toast styles */
      .toast {
        position: fixed;
        bottom: 1rem;
        left: 1rem;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        display: none;
        z-index: 1000;
      }

      /* Loading overlay styles */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
        display: none;
      }

      .loading-overlay span {
        color: #fff;
        font-size: 1.5rem;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <div class="loading-overlay">
      <span>Loading...</span>
    </div>

    <div class="container">
      <h1>Grainient.</h1>
      <h3>Create a Gradient with some Grain.</h3>
      <div class="canvas-container">
        <canvas id="gradientCanvas"></canvas>
      </div>
      <div class="controls">
        <div class="control">
          <label for="color1">Start Color:</label>
          <input type="color" id="color1" />
        </div>
        <div class="control">
          <label for="color2">End Color:</label>
          <input type="color" id="color2" />
        </div>
        <div class="control">
          <label for="grainAmount">Grain Intensity:</label>
          <input type="range" id="grainAmount" min="0" max="50" value="10" />
          <span id="grainAmountValue">10</span>
        </div>
        <button id="applyButton">Apply Changes</button>
        <button id="resetButton">Reset</button>
        <button id="saveButton">Save Image</button>
        <button id="downloadZipButton">Download 50 Wallpapers</button>
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      function hexToRgb(hex) {
        return {
          r: parseInt(hex.slice(1, 3), 16),
          g: parseInt(hex.slice(3, 5), 16),
          b: parseInt(hex.slice(5, 7), 16),
        };
      }

      function generateGradientWithGrain(
        width,
        height,
        color1,
        color2,
        grainIntensity
      ) {
        const canvas = document.getElementById("gradientCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = width;
        canvas.height = height;

        const imageData = ctx.createImageData(width, height);
        const data = imageData.data;

        const c1 = hexToRgb(color1);
        const c2 = hexToRgb(color2);

        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            const t = x / width;
            const r = Math.floor(c1.r * (1 - t) + c2.r * t);
            const g = Math.floor(c1.g * (1 - t) + c2.g * t);
            const b = Math.floor(c1.b * (1 - t) + c2.b * t);
            const index = (y * width + x) * 4;

            data[index] = r;
            data[index + 1] = g;
            data[index + 2] = b;
            data[index + 3] = 255;
          }
        }

        for (let i = 0; i < data.length; i += 4) {
          const grain = Math.random() * grainIntensity - grainIntensity / 2;
          data[i] = Math.min(255, Math.max(0, data[i] + grain));
          data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + grain));
          data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + grain));
        }

        ctx.putImageData(imageData, 0, 0);
      }

      function initializeRandomValues() {
        color1Input.value = getRandomColor();
        color2Input.value = getRandomColor();
        grainAmountInput.value = Math.floor(Math.random() * 26); // Random value between 0 and 50
        grainAmountValueSpan.textContent = grainAmountInput.value;
        updateCanvas();
      }

      function getRandomColor() {
        return `#${Math.floor(Math.random() * 0xffffff)
          .toString(16)
          .padStart(6, "0")}`;
      }

      function updateCanvas() {
        const color1 = color1Input.value;
        const color2 = color2Input.value;
        const grainIntensity = parseInt(grainAmountInput.value);

        grainAmountValueSpan.textContent = grainIntensity;
        generateGradientWithGrain(
          canvasContainer.clientWidth,
          canvasContainer.clientHeight,
          color1,
          color2,
          grainIntensity
        );
      }

      function saveImage() {
        const width = 1920;
        const height = 1080;
        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        const gradientCanvas = document.getElementById("gradientCanvas");

        generateGradientWithGrain(
          width,
          height,
          color1Input.value,
          color2Input.value,
          parseInt(grainAmountInput.value)
        );
        ctx.drawImage(gradientCanvas, 0, 0, width, height);

        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "gradient.png";
        link.click();
      }

      function resetControls() {
        initializeRandomValues();
      }

      async function downloadZip() {
        // Show confirmation dialog
        const confirmDownload = confirm(
          "Do you really want to download 20 wallpapers? This might take a moment. (Site Will Freeze)"
        );

        if (!confirmDownload) {
          return; // Exit the function if the user does not confirm
        }

        showLoadingOverlay();
        const zip = new JSZip();
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const numWallpapers = 20;
        const width = 1920;
        const height = 1080;

        canvas.width = width;
        canvas.height = height;

        for (let i = 0; i < numWallpapers; i++) {
          const color1 = getRandomColor();
          const color2 = getRandomColor();
          const grainIntensity = Math.floor(Math.random() * 26); // Random value between 0 and 50

          generateGradientWithGrain(
            width,
            height,
            color1,
            color2,
            grainIntensity
          );
          ctx.drawImage(
            document.getElementById("gradientCanvas"),
            0,
            0,
            width,
            height
          );

          const imageData = canvas.toDataURL("image/png");
          const imageName = `wallpaper${i + 1}.png`;
          zip.file(imageName, imageData.split(",")[1], { base64: true });
        }

        zip.generateAsync({ type: "blob" }).then(function (content) {
          hideLoadingOverlay();
          const link = document.createElement("a");
          link.href = URL.createObjectURL(content);
          link.download = "wallpapers.zip";
          link.click();
        });
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.style.display = "block";
        setTimeout(() => {
          toast.style.display = "none";
        }, 3000); // Hide after 3 seconds
      }

      function showLoadingOverlay() {
        document.querySelector(".loading-overlay").style.display = "flex";
      }

      function hideLoadingOverlay() {
        document.querySelector(".loading-overlay").style.display = "none";
      }

      // Initialize DOM elements
      const color1Input = document.getElementById("color1");
      const color2Input = document.getElementById("color2");
      const grainAmountInput = document.getElementById("grainAmount");
      const grainAmountValueSpan = document.getElementById("grainAmountValue");
      const canvasContainer = document.querySelector(".canvas-container");

      // Debounced update function
      const updateCanvasDebounced = debounce(updateCanvas, 200);

      // Event listeners
      color1Input.addEventListener("input", updateCanvasDebounced);
      color2Input.addEventListener("input", updateCanvasDebounced);
      grainAmountInput.addEventListener("input", updateCanvasDebounced);
      document.getElementById("applyButton").addEventListener("click", () => {
        updateCanvas();
        showToast("Changes Applied!");
      });
      document.getElementById("resetButton").addEventListener("click", () => {
        resetControls();
        showToast("Controls Reset!");
      });
      document.getElementById("saveButton").addEventListener("click", () => {
        saveImage();
        showToast("Image Saved!");
      });
      document
        .getElementById("downloadZipButton")
        .addEventListener("click", () => {
          downloadZip();
        });

      // Debounce function
      function debounce(fn, delay) {
        let timeoutId;
        return function (...args) {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => fn.apply(this, args), delay);
        };
      }

      // Initialize with random values on page load
      initializeRandomValues();
    </script>
  </body>
</html>
